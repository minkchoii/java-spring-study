# 1.1 초난감 DAO

- DAO
    
    `Data access object: DB를 사용해 데이터를 조회하거나 조작하는 기능을 전담하도록 만든 오브젝트` 
    

- 사용자 정보를 JDBC API를 통해 DB에 저장하고 조회할 수 있는 간단한 DAO를 하나 만들어보자
    - 자바빈 규약을 따르는 오브젝트를 이용하면 편리함
    - 먼저 사용자 정보를 저장할 User 클래스 만들기
    
    ```jsx
    package springbook.user.domain;
    
    public class User {
    	String id;
    	String name;
    	String password;
    	
    	public String getId() {
    		return id;
    	}
    	public String setId(String id) {
    		this.id = id;
    	}
    	public String getName() {
    		return name;
    	}
    	public String setName(String name) {
    		this.name = name;
    	}
    	public String getPassword() {
    		return password;
    	}
    	public String setPassword(String password) {
    		this.password = password;
    	}
    }
    ```
    
    - User 오브젝트에 담긴 정보가 실제로 보관될 DB의 테이블을 하나 만들자
    - 테이블 이름: USER, 프로퍼티: User class의 프로퍼티와 동일하게 구성
    
    | 필드명 | 타입 | 설정 |
    | --- | --- | --- |
    | Id | VARCHAR(10) | primar key |
    | Name | VARCHAR(20) | not null |
    | Passwordk | VARCHAR(20) | not null |
    - MySQL을 사용한다면 DB 생성 후 CREATE TABLE 명령을 실행해 테이블을 만들면 됨
    
    ```jsx
    create table users(
    	id varchar(10) primary key,
    	name varchar(20) not null,
    	password varchar(20) not null
    )
    ```
    
- 자바빈
    - 비주얼 툴에서 조작 가능한 컴포넌트
    - `디폴트 생성자` : 자바빈은 파라미터가 없는 디폴트 생성자를 갖고 있어야 함
        
        → 툴이나 프레임워크에서 리플렉션을 이용해 오브젝트를 생성하기 때문
        
    - `프로퍼티` : 자바빈이 노출하는 이름을 가진 속성
        
        → 수정자 메소드 setter와 접근자 메소드 getter를 이용해 수정 또는 조회 가능
        
- DAO 클래스를 만들어보자
- JDBC
    
    Java기반 애플리케이션의 데이터를 DB에 저장 및 업데이터하거나, 데이터를 Java에서 사용할 수 있도록 하는 자바 API
    
    ![3가지 기능을 표준 인터페이스로 정의하여 제공](https://prod-files-secure.s3.us-west-2.amazonaws.com/009a30ff-1579-476d-a248-96bf29a9a004/bbf03067-f3b6-4231-ac9d-495a4d3a172e/Untitled.png)
    
    3가지 기능을 표준 인터페이스로 정의하여 제공
    
    - java.sql.Connection: 연결
    - java.sql.Statement: SQL을 담은 내용
    - java.sql.ResultSet: SQL 요청 응답
- JDBC 동작 흐름
    
    ![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/009a30ff-1579-476d-a248-96bf29a9a004/ed983968-3db9-4f81-897c-c972c5e31c7b/Untitled.png)
    
    - Java 애플리케이션 내에서 JDBC API를 사용하여 데이터베이스에 접근하는 단순한 구조
    - JDBC 드라이버를 먼저 로딩한 후 데이터베이스와 연결

- JDBC를 이용하는 작업의 일반적인 순서
    
    1️⃣ DB 연결을 위한 `connection`을 가져온다
    
    2️⃣ SQL을 담은 `statement`를 만든다
    
    3️⃣ 만들어진 Statement를 실행한다
    
    4️⃣ `조회` : sql 쿼리 실행 결과를 `resultset`으로 받아서 정보를 저장할 객체(User)에 옮겨준다
    
    5️⃣ 작업 중 생성된 `connection`, `statement`, `resultset` 같은 리소스는 작업 후 반드시 닫아
    
    6️⃣ jdbc api가 만들어내는 `예외를 잡아서` 직접 처리/`메소드에 throw`를 처리하여 던지는게 편함
    
- 예제
    
    ```jsx
    package springbook.user.dao;
    ...
    public class UserDao {
    	public void add(User user) throws ClassNotFoundException, SQLException {
    		Class.forName("com.mysql.jdbc.Driver"); //드라이버를 로딩
    		Connection c = DriverManager.getConnection("jdbc:mysql://localhost/springbook", "spring", "book");
    		//DriverManager.getConnection(): DB와 연결하는 메소드, URL, 사용자명, 비밀번호를 매개변수로 전달
    		PreparedStatement ps = c.prepareStatement("insert into users(id, name, password) values(?, ?, ?)");
    		ps.setString(1, user, getId()); //만들어진 statement 실행
    		ps.setString(2, user, getName());
    		ps.setString(3, user, getPassword());
    
    		ps.executeUpdate(); //sql 실행결과를 업데이트
    		ps.close(); //작업 후 반드시 닫기
    		c.close();
    	}
    }
    ```
    
    이 클래스가 제대로 동작하는 지 확인하기 위해서는 서버에 배치하고 브라우저를 통해 사용해보는 것이 가장 확실하지만, 너무 부담이 크기 때문에 main method를 활용하여 테스트 해보는 것이 가장 간단함
    

- main()을 이용한 DAO 테스트 코드
    
    1) main 메소드를 만든다
    
    2) UserDao의 객체를 생성해서 add()와 get()을 테스트
    
    3) DB에 add()를 사용해서 정보를 등록
    
    4) 조회용으로 만든 get()으로 이상이 있는 지 확인해 볼 수 있다
    
- 예제
    
    ```jsx
    public void main(String[] args) throws ClassNotFoundException, SQLException {
    	UserDao dao = new UserDao();
    	User user = new User();
    	
    	user.setId("whiteship");
    	user.setName("백기선");
    	user.setPassword("married");
    	dao.add(user);
    
    	System.out.println(user.getId + "등록 성공");
    	User user2 = dao.get(user.getId());
    	System.out.println(user2.getName());
    	System.out.println(user2.getPassword());
    	System.out.println(user2.getId() + "조회 성공");
    }
    
    결과 실행 시:
    whiteship 등록 성공
    백기선
    married
    whiteship 조회 성공
    ```
    
    이 클래스 실행 시, 테스트 성공 메시지를 얻을 수 있다
    
    실패했다면 DB 설정과 Connection 정보를 확인하고, DB 드라이버가 클래스패스에 있어야 함
    
    하지만 이 코드는 문제가 있는 한심한 코드임 ㅋㅋ;

