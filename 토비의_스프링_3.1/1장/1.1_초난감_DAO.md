**참고)**
- JDBC란?
[[Java] JDBC를 사용한 데이터베이스 연동(Mysql)](https://devlog-wjdrbs96.tistory.com/139)

- 자바빈 규약
[[JAVAEE] 자바빈(JavaBean) 이란? 자바빈 규약에 대해](https://dololak.tistory.com/133)

---

- 사용자 정보를 JDBC API를 통해 DB에 저장하고 조회할 수 있는 간단한 DAO를 하나 만들어보자.

> **DAO**
> 
> DAO(Data Access Object)는 DB를 사용해 데이터를 조회하거나 조작하는 기능을 전담하도록 만든 오브젝트를 말한다.

## 1.1.1 User

- 사용자 정보를 저장할 `User` 클래스를 만든다.

```java
package springbook.user.domain;

public class User { 
		// 세가지 프로퍼티를 가짐
    String id;
    String name; 
    String password;
    
    public String getld() { 
        return id;
    }

    public void setId(String id) {
        this.id = id;
    }
    public String getName() {
        return name; 
    }
    
    public void setName(String name) { 
        this.name = name;
    }
		
    public String getPassword() {
        return password; 
    }

    public void setPassword(String password) { 
        this.password = password;
    } 
}
```

### Getter & Setter

- `getter`와 `setter`는 객체지향 프로그래밍에서 클래스의 프로퍼티(변수)에 접근하고 값을 설정하기 위한 메서드이다.
    1. `Getter` (접근자 메서드)
        - 프로퍼티의 값을 가져오는 역할
        - 일반적으로 `get프로퍼티`로 메서드 이름을 정의한다.
        - 다른 객체에서 프로퍼티 값을 참조하고자 할 때 사용한다.
    2. `Setter` (설정자 메서드)
        - 프로퍼티의 값을 설정하는 역할
        - 일반적으로 `set프로퍼티`로 메서드 이름을 정의한다.
        - 다른 객체에서 프로퍼티 값을 변경하고자 할 때 사용한다.
- `Getter`와 `setter`는 객체의 정보 은닉과 캡슐화를 지원하는 중요한 개념이다.
- 프로퍼티에 직접 접근하는 것이 아니라 `getter`와 `setter`를 통해 접근하므로, 객체 내부의 구현 상세를 숨기고 외부에서 안전하게 프로퍼티 값을 조작할 수 있다.
- 이를 통해 코드의 유지 보수성과 재사용성을 높일 수 있다.

### USER 테이블

- `User` 오브젝트에 담긴 정보가 실제로 보관될 DB 테이블

| 필드명 | 타입 | 설정 |
| --- | --- | --- |
| Id | VARCHAR(10) | Primary Key |
| Name | VARCHAR(20) | Not Null |
| Password | VARCHAR(20) | Not Null |
- PK(Primary Key)는 테이블 행의 여러 정보들 중 행을 식별할 수 있어야 하는 때문에 비어있으면 안되고(NOT NULL) 중복되어서도 안된다(Unique). 그리고 식별을 할 때 테이블의 정보를 최대한 빠르게 검색해야 하므로 간단한 정보일 수록 좋다.
    - 이름과 비밀번호는 사람들마다 동일할 수 있지만 Id는 동일하면 안된다.
- 예시) MySQL을 사용한다면 DB생성 후에 다음과 같은 CREATE TABEL 명령을 실행해 테이블을 만들면 된다.

```java
create table users {
		id varchar(10) primary key,
		name varchar(20) not null,
		password varchar(10) not null
}
```

## 1.1.2 UserDao

- 사용자 정보를 DB에 넣고 관리할 수 있는 DAO 클래스를 만들어보자.
- 클래스 이름: `UserDAO`
- JDBC를 이용하는 작업의 일반적인 순서
    1. DB 연결을 위한 `Connection`을 가져온다.
    2. SQL을 담은 `Statement`(또는 `PreparedStatement`)를 만든다.
    3. 만들어진 `Statement`를 실행한다.
    4. 조회의 경우 SQL 쿼리의 실행 결과를 `ResultSet`으로 받아서 정보를 저장할 오브젝트(여기서는 `User`)에 옮겨준다.
    5. 작업 중에 생성된 `Connection`, `Statement`, `ResultSet` 같은 리소스는 작업을 마친 후 반드시 닫아준다.
    6. JDBC API가 만들어내는 예외를 잡아서 직접 처리하거나, 메소드에 `throws`를 선언해서 예외가 발생하면 메소드 밖으로 던지게 한다.

```java
package springbook.user.dao;

import springbook.user.domain.User;
import java.sql.*;

public class UserDao {
    // 사용자 정보를 추가하는 메서드
    public void add(User user) throws ClassNotFoundException, SQLException { // JDBC API가 만들어내는 예외를 잡아서 직접 처리하거나, 메소드에 throws를 선언해서 예외가 발생하면 메소드 밖으로 던지게 한다.
        // MySQL JDBC 드라이버를 로드
        Class.forName("com.mysql.jdbc.Driver");
        // 1. DB 연결을 위한 Connection을 가져온다.
        Connection c = DriverManager.getConnection("jdbc:mysql://localhost/springbook", "spring", "book");

        // 2. SQL을 담은 Statement(또는 PreparedStatement)를 만든다.
        PreparedStatement ps = c.prepareStatement("insert into users(id, name, password) values(?, ?, ?)");
        // 파라미터 값을 설정
        ps.setString(1, user.getId());
        ps.setString(2, user.getName());
        ps.setString(3, user.getPassword());

        // 3. 만들어진 Statement를 실행한다.
        ps.executeUpdate();

        // 5. 작업 중에 생성된 Connection, Statement, ResultSet 같은 리소스는 작업을 마친 후 반드시 닫아준다.
        ps.close();
        c.close();
    }

    // 사용자 정보를 조회하는 메서드
    public User get(String id) throws ClassNotFoundException, SQLException { // JDBC API가 만들어내는 예외를 잡아서 직접 처리하거나, 메소드에 throws를 선언해서 예외가 발생하면 메소드 밖으로 던지게 한다.
        // MySQL JDBC 드라이버를 로드
        Class.forName("com.mysql.jdbc.Driver");
        // 1. DB 연결을 위한 Connection을 가져온다.
        Connection c = DriverManager.getConnection("jdbc:mysql://localhost/springbook", "spring", "book");

        // 2. SQL을 담은 Statement(또는 PreparedStatement)를 만든다.
        PreparedStatement ps = c.prepareStatement("select * from users where id = ?");
        // 파라미터 값을 설정
        ps.setString(1, id);

        // 4. 조회의 경우 SQL 쿼리의 실행 결과를 ResultSet으로 받아서
        ResultSet rs = ps.executeQuery();
        // 정보를 저장할 오브젝트(여기서는 User)에 옮겨준다.
        rs.next();

        User user = new User();
        user.setId(rs.getString("id"));
        user.setName(rs.getString("name"));
        user.setPassword(rs.getString("password"));

        // 5. 작업 중에 생성된 Connection, Statement, ResultSet 같은 리소스는 작업을 마친 후 반드시 닫아준다.
        rs.close();
        ps.close();
        c.close();

        // 조회한 사용자 정보를 반환
        return user;
    }
```

## 1.1.3 main()을 이용한 DAO 테스트 코드

```java
		// 테스트용 메인메서드
    public static void main(String[] args) throws SQLException, ClassNotFoundException {
        // 사용자 정보 생성
        User user = new User();
        user.setId("nanami-tomoe");
        user.setName("이승현");
        user.setPassword("dltmdgus1234@");

        // UserDao 객체 생성
        UserDao userDao = new UserDao();
        // 사용자 정보 추가
        userDao.add(user);

        System.out.println(user.getId() + " 등록 성공");

        // 등록한 사용자 정보 조회
        User user2 = userDao.get(user.getId());
        System.out.println(user2.getName());
        System.out.println(user2.getPassword());
        System.out.println(user2.getId() + " 조회 성공");
    }
}
```

- 사용할 DB의 드라이버가 클래스패스에 있어야 하는 것도 잊지 말자.
- 원하는 기능은 잘 수행하지만 쫓겨날만한 코드… → 여기까지 만든 `UserDao` 클래스의 문제는 무엇일까?
